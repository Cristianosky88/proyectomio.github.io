<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Jackpot - Mejorado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #f8fafc; font-family: sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">

    <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden border border-slate-200">
        <!-- Header -->
        <div class="bg-slate-900 p-5 text-white flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-lg">
                    <i data-lucide="wallet" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Registro de Jackpot - Modelo N° 1</h1>
                    <p class="text-slate-400 text-xs uppercase tracking-wider">Planilla de Reporte Jackpot</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <button type="button" id="btnJackpot2Header" class="px-4 py-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white hover:from-yellow-500 hover:to-orange-600 rounded-lg font-bold text-sm transition shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center gap-2 border-2 border-yellow-300">
                    <i data-lucide="zap" class="w-4 h-4"></i> Jackpot 2
                </button>
                <div class="text-right">
                    <div class="text-xs text-slate-400">Fecha</div>
                    <div class="font-mono font-bold text-lg" id="fechaActual">--/--/--</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="bg-white">
            <form id="formJackpot" class="space-y-0" autocomplete="off" novalidate>
                
                <!-- 1. INFORMACION DE CONTACTO CCTV -->
                <div class="border-b border-slate-200 p-6">
                    <h3 class="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                        <span class="bg-slate-200 text-slate-700 w-8 h-8 rounded-full flex items-center justify-center font-semibold">1</span>
                        Informacion de Contacto CCTV
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Hora de Aviso a CCTV <span class="text-red-500">*</span></label>
                            <input type="time" id="hora_cctv" name="hora_cctv" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Quien Llama <span class="text-red-500">*</span></label>
                            <select id="quien_llama" name="quien_llama" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="">Seleccionar...</option>
                                <option value="Encargado">Encargado</option>
                                <option value="Gerente">Gerente</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Asistente">Asistente</option>
                                <option value="Operador">Operador</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Nombre del Personal <span class="text-red-500">*</span></label>
                            <input type="text" id="nombre_llama" name="nombre_llama" placeholder="Nombre completo" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none uppercase">
                        </div>
                    </div>
                </div>

                <!-- 2. INFORMACION DEL JACKPOT -->
                <div class="border-b border-slate-200 p-6">
                    <h3 class="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                        <span class="bg-slate-200 text-slate-700 w-8 h-8 rounded-full flex items-center justify-center font-semibold">2</span>
                        Informacion del Jackpot
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">No. Maquina (6 digitos) <span class="text-red-500">*</span></label>
                            <input type="text" id="nro_maquina" name="nro_maquina" pattern="[0-9]{6}" maxlength="6" inputmode="numeric" placeholder="120305" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                            <small class="text-slate-500 text-xs mt-1">Exactamente 6 digitos</small>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Importe Jackpot ($) <span class="text-red-500">*</span></label>
                            <input type="text" id="importe" name="importe" placeholder="0,00" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none font-semibold text-green-700">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Hora de Revision <span class="text-red-500">*</span></label>
                            <input type="time" id="hora_revision" name="hora_revision" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                            <small class="text-red-500 text-xs mt-1 hidden" id="errorHora1">Debe ser mayor a hora CCTV</small>
                        </div>
                    </div>
                </div>

                <!-- 3. INFORMACION DEL CLIENTE -->
                <div class="border-b border-slate-200 p-6">
                    <h3 class="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                        <span class="bg-slate-200 text-slate-700 w-8 h-8 rounded-full flex items-center justify-center font-semibold">3</span>
                        Informacion del Cliente
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Genero <span class="text-red-500">*</span></label>
                            <select id="tipo_cliente" name="tipo_cliente" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="">Seleccionar...</option>
                                <option value="Cliente">Sr. (Masculino)</option>
                                <option value="Clienta">Sra. (Femenino)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Nombre del Cliente <span class="text-red-500">*</span></label>
                            <input type="text" id="nombre_cliente" name="nombre_cliente" placeholder="Nombre completo" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none uppercase">
                        </div>
                    </div>
                </div>

                <!-- 4. INFORMACION DE PAGO -->
                <div class="border-b border-slate-200 p-6">
                    <h3 class="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                        <span class="bg-slate-200 text-slate-700 w-8 h-8 rounded-full flex items-center justify-center font-semibold">4</span>
                        Informacion de Pago
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Hora de Pago <span class="text-red-500">*</span></label>
                            <input type="time" id="hora_pago" name="hora_pago" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                            <small class="text-red-500 text-xs mt-1 hidden" id="errorHora2">Debe ser mayor a hora Revision</small>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Quien Paga <span class="text-red-500">*</span></label>
                            <select id="quien_paga" name="quien_paga" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="">Seleccionar...</option>
                                <option value="Jefe de Caja">Jefe de Caja</option>
                                <option value="Asistente de Caja">Asistente de Caja</option>
                                <option value="Cajero">Cajero</option>
                                <option value="Cajera">Cajera</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Nombre <span class="text-red-500">*</span></label>
                            <input type="text" id="nombre_paga" name="nombre_paga" placeholder="Nombre personal" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none uppercase">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Hora Descarga <span class="text-red-500">*</span></label>
                            <input type="time" id="hora_descarga" name="hora_descarga" required class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                    </div>
                </div>

                <!-- 5. INFORMACION ADICIONAL -->
                <div class="border-b border-slate-200 p-6">
                    <h3 class="font-bold text-slate-800 text-lg mb-4 flex items-center gap-2">
                        <span class="bg-slate-200 text-slate-700 w-8 h-8 rounded-full flex items-center justify-center font-semibold">5</span>
                        Informacion Adicional
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Juego</label>
                            <select id="juego" name="juego" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="">Seleccionar...</option>
                                <option value="88 FORTUNE">88 FORTUNE</option>
                                <option value="BUFFALO">BUFFALO</option>
                                <option value="DRAGON LINK">DRAGON LINK</option>
                                <option value="LIGHTNING LINK">LIGHTNING LINK</option>
                                <option value="WHEEL OF FORTUNE">WHEEL OF FORTUNE</option>
                                <option value="GOLDEN GODDESS">GOLDEN GODDESS</option>
                                <option value="CASH BURST">CASH BURST</option>
                                <option value="LUCKY LUCKY">LUCKY LUCKY</option>
                                <option value="OTRO">Otro</option>
                            </select>
                            <input type="text" id="juego_personalizado" name="juego_personalizado" placeholder="Ingrese nombre del juego" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none mt-2 hidden" />
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Marca Maquina</label>
                            <select id="maquina_independiente" name="maquina_independiente" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                                <option value="">Seleccionar...</option>
                                <option value="BALLY">BALLY</option>
                                <option value="ARISTOCRAT">ARISTOCRAT</option>
                                <option value="IGT">IGT</option>
                                <option value="KONAMI">KONAMI</option>
                                <option value="SCIENTIFIC GAMES">SCIENTIFIC GAMES</option>
                                <option value="AINSWORTH">AINSWORTH</option>
                                <option value="NOVOMATIC">NOVOMATIC</option>
                                <option value="OTRO">Otro</option>
                            </select>
                            <input type="text" id="maquina_personalizada" name="maquina_personalizada" placeholder="Ingrese marca de máquina" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none mt-2 hidden" />
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-600 mb-2">Pago Manual</label>
                            <input type="text" id="pago_manual" name="pago_manual" placeholder="00000" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-xs font-semibold text-slate-600 mb-2">Observaciones <small class="text-slate-500 font-normal">(<span id="charCount">0</span>/200)</small></label>
                        <textarea id="observaciones" name="observaciones" placeholder="Detalles especiales, notas importantes..." rows="3" maxlength="200" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none"></textarea>
                    </div>
                </div>

                <!-- 7. BOTONES DE ACCION -->
                <div class="bg-slate-50 p-6 border-t border-slate-200">
                    <div class="flex flex-wrap gap-3 justify-center items-center">
                        <button type="submit" id="btnGuardar" class="px-4 py-2 bg-emerald-600 text-white hover:bg-emerald-700 rounded font-semibold text-sm transition flex items-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i> Guardar Registro
                        </button>
                        <button type="button" id="btnGenerarResumen" class="px-4 py-2 bg-indigo-500 text-white hover:bg-indigo-600 rounded font-semibold text-sm transition flex items-center gap-2">
                            <i data-lucide="file-text" class="w-4 h-4"></i> Generar Informe
                        </button>
                        <button type="button" id="btnLimpiarTodo" class="px-4 py-2 bg-slate-500 text-white hover:bg-slate-600 rounded font-semibold text-sm transition flex items-center gap-2">
                            <i data-lucide="refresh-ccw" class="w-4 h-4"></i> Limpiar Form
                        </button>
                        <button type="button" id="btnBorrarRegistros" class="px-4 py-2 bg-rose-600 text-white hover:bg-rose-700 rounded font-semibold text-sm transition flex items-center gap-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i> Borrar Registros
                        </button>
                        <button type="button" id="btnInicio" class="px-6 py-2 bg-slate-800 text-white hover:bg-slate-900 rounded font-semibold text-sm transition flex items-center gap-2">
                            <i data-lucide="home" class="w-4 h-4"></i> Volver
                        </button>
                    </div>
                </div>
            </form>

            <!-- RESUMEN -->
            <div id="resumen" class="hidden p-6 bg-indigo-50 border-t border-indigo-200 text-sm whitespace-pre-wrap font-mono leading-relaxed text-slate-700"></div>

            <!-- TABLA DE REGISTROS -->
            <div class="p-6 border-t border-slate-200">
                <h2 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <i data-lucide="database" class="w-5 h-5"></i> Registros Guardados (Local)
                </h2>
                <div class="mb-4 flex gap-2">
                    <input type="text" id="buscarRegistros" placeholder="Buscar por maquina, cliente, fecha..." class="flex-1 p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-indigo-500 outline-none">
                    <button type="button" id="btnLimpiarBusqueda" class="px-3 py-2 bg-slate-300 text-slate-700 hover:bg-slate-400 rounded text-sm transition">Limpiar</button>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm border-collapse">
                        <thead>
                            <tr class="bg-slate-100 border-b border-slate-300">
                                <th class="p-2 text-left font-semibold text-slate-700">#</th>
                                <th class="p-2 text-left font-semibold text-slate-700">Fecha/Hora</th>
                                <th class="p-2 text-left font-semibold text-slate-700">Maquina</th>
                                <th class="p-2 text-left font-semibold text-slate-700">Importe</th>
                                <th class="p-2 text-left font-semibold text-slate-700">Cliente</th>
                                <th class="p-2 text-left font-semibold text-slate-700">Duracion</th>
                                <th class="p-2 text-left font-semibold text-slate-700">Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tbodyRegistros">
                            <tr><td colspan="7" class="p-4 text-center text-slate-500">Sin registros guardados</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICACIONES -->
    <div id="notification" class="hidden fixed bottom-4 right-4 bg-green-100 text-green-800 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 fade-in z-40">
        <i data-lucide="check-circle" class="w-4 h-4"></i>
        <span id="notification-text">Operacion exitosa</span>
    </div>

</body>

<script>
    lucide.createIcons();

    // ===== VARIABLES GLOBALES =====
    const form = document.getElementById('formJackpot');
    const inputs_hora = ['hora_cctv', 'hora_revision', 'hora_pago', 'hora_descarga'];
    let registrosFiltrados = [];

    // ===== PERSONALIZACIÓN DE JUEGO Y MARCA =====
    document.getElementById('juego').addEventListener('change', (e) => {
        const personalizadoInput = document.getElementById('juego_personalizado');
        if (e.target.value === 'OTRO') {
            personalizadoInput.classList.remove('hidden');
            personalizadoInput.required = true;
        } else {
            personalizadoInput.classList.add('hidden');
            personalizadoInput.required = false;
            personalizadoInput.value = '';
        }
    });

    document.getElementById('maquina_independiente').addEventListener('change', (e) => {
        const personalizadoInput = document.getElementById('maquina_personalizada');
        if (e.target.value === 'OTRO') {
            personalizadoInput.classList.remove('hidden');
            personalizadoInput.required = true;
        } else {
            personalizadoInput.classList.add('hidden');
            personalizadoInput.required = false;
            personalizadoInput.value = '';
        }
    });

    // ===== RECONOCER COMAS EN CAMPOS DECIMALES =====
    ['importe', 'pago_manual'].forEach(id => {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('blur', (e) => {
                // Reemplazar comas por puntos
                let valor = e.target.value.replace(',', '.');
                // Validar que sea un número válido
                if (valor && !isNaN(valor)) {
                    e.target.value = valor;
                }
            });
        }
    });

    // ===== FUNCIONES AUXILIARES =====
    function actualizarFecha() {
        const now = new Date();
        const opciones = { day: '2-digit', month: '2-digit', year: 'numeric' };
        document.getElementById('fechaActual').textContent = now.toLocaleDateString('es-AR', opciones);
    }

    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        document.getElementById('notification-text').textContent = message;
        notification.classList.remove('hidden', 'bg-red-100', 'text-red-800');
        if (type === 'error') {
            notification.classList.add('bg-red-100', 'text-red-800');
        } else {
            notification.classList.add('bg-green-100', 'text-green-800');
        }
        setTimeout(() => notification.classList.add('hidden'), 3000);
    }

    // ===== VALIDACION DE HORAS =====
    function validarHoras() {
        const h1 = document.getElementById('hora_cctv').value;
        const h2 = document.getElementById('hora_revision').value;
        const h3 = document.getElementById('hora_pago').value;
        const err1 = document.getElementById('errorHora1');
        const err2 = document.getElementById('errorHora2');

        let valido = true;

        // Validar hora_revision > hora_cctv
        if (h1 && h2 && h2 <= h1) {
            err1.classList.remove('hidden');
            valido = false;
        } else {
            err1.classList.add('hidden');
        }

        // Validar hora_pago > hora_revision
        if (h2 && h3 && h3 <= h2) {
            err2.classList.remove('hidden');
            valido = false;
        } else {
            err2.classList.add('hidden');
        }

        return valido;
    }

    // ===== CALCULAR DURACION =====
    function calcularDuracion() {
        const h1 = document.getElementById('hora_cctv').value;
        const h2 = document.getElementById('hora_revision').value;
        const h3 = document.getElementById('hora_pago').value;

        function tiempoEnMinutos(hora) {
            if (!hora) return null;
            const [h, m] = hora.split(':');
            return parseInt(h) * 60 + parseInt(m);
        }

        const t1 = tiempoEnMinutos(h1);
        const t2 = tiempoEnMinutos(h2);
        const t3 = tiempoEnMinutos(h3);

        const dur1 = t1 && t2 ? (t2 - t1) : null;
        const dur2 = t2 && t3 ? (t3 - t2) : null;
        const dur3 = t1 && t3 ? (t3 - t1) : null;

        document.getElementById('duracion1').textContent = dur1 ? `${dur1} min` : '-- min';
        document.getElementById('duracion2').textContent = dur2 ? `${dur2} min` : '-- min';
        document.getElementById('duracion3').textContent = dur3 ? `${dur3} min` : '-- min';
    }

    // ===== CONTAR CARACTERES =====
    document.getElementById('observaciones')?.addEventListener('input', (e) => {
        document.getElementById('charCount').textContent = e.target.value.length;
    });

    // ===== CALCULAR DURACION EN TIEMPO REAL =====
    inputs_hora.forEach(id => {
        document.getElementById(id)?.addEventListener('change', () => {
            validarHoras();
            calcularDuracion();
        });
    });

    // ===== GUARDAR REGISTRO =====
    form.addEventListener('submit', (e) => {
        e.preventDefault();

        if (!validarHoras()) {
            showNotification('Error: Las horas no son validas', 'error');
            return;
        }

        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        
        // Reemplazar valores con personalizados si es necesario
        if (data.juego === 'OTRO' && data.juego_personalizado) {
            data.juego = data.juego_personalizado;
        }
        if (data.maquina_independiente === 'OTRO' && data.maquina_personalizada) {
            data.maquina_independiente = data.maquina_personalizada;
        }
        
        const registro = {
            timestamp: new Date().toLocaleString('es-AR'),
            data: data,
            duracion: document.getElementById('duracion3').textContent
        };

        let registros = JSON.parse(localStorage.getItem('jackpotRegistros') || '[]');
        registros.push(registro);
        if (registros.length > 50) registros.shift();
        localStorage.setItem('jackpotRegistros', JSON.stringify(registros));
        localStorage.setItem('jackpotLastRecord', JSON.stringify(registro.data));

        showNotification('OK - Registro guardado exitosamente');
        actualizarTabla();
    });

    // ===== ACTUALIZAR TABLA =====
    function actualizarTabla(filtro = '') {
        const registros = JSON.parse(localStorage.getItem('jackpotRegistros') || '[]');
        const tbody = document.getElementById('tbodyRegistros');

        registrosFiltrados = registros.filter(reg => {
            if (!filtro) return true;
            const busqueda = filtro.toLowerCase();
            return (
                reg.data.nro_maquina?.toLowerCase().includes(busqueda) ||
                reg.data.nombre_cliente?.toLowerCase().includes(busqueda) ||
                reg.timestamp?.toLowerCase().includes(busqueda)
            );
        });

        if (registrosFiltrados.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" class="p-4 text-center text-slate-500">Sin registros guardados</td></tr>';
            return;
        }

        tbody.innerHTML = registrosFiltrados.map((reg, idx) => `
            <tr class="border-b border-slate-200 hover:bg-slate-50">
                <td class="p-2">${idx + 1}</td>
                <td class="p-2 text-xs">${reg.timestamp}</td>
                <td class="p-2 font-mono font-bold text-indigo-600">${reg.data.nro_maquina}</td>
                <td class="p-2 text-green-700 font-semibold">$${parseFloat(reg.data.importe).toFixed(2)}</td>
                <td class="p-2">${reg.data.nombre_cliente}</td>
                <td class="p-2 text-blue-600 font-semibold">${reg.duracion}</td>
                <td class="p-2 flex gap-1">
                    <button class="px-2 py-1 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded text-xs transition" onclick="verDetalle(${registros.indexOf(reg)})">Ver</button>
                    <button class="px-2 py-1 bg-red-100 text-red-700 hover:bg-red-200 rounded text-xs transition" onclick="eliminarRegistro(${registros.indexOf(reg)})">Del</button>
                </td>
            </tr>
        `).join('');
    }

    // ===== BUSCAR REGISTROS =====
    document.getElementById('buscarRegistros').addEventListener('input', (e) => {
        actualizarTabla(e.target.value);
    });

    document.getElementById('btnLimpiarBusqueda').addEventListener('click', () => {
        document.getElementById('buscarRegistros').value = '';
        actualizarTabla();
        showNotification('Busqueda limpiada');
    });

    // ===== GENERAR RESUMEN =====
    document.getElementById('btnGenerarResumen').addEventListener('click', function() {
        const inputs = form.querySelectorAll('input, select, textarea');
        let resumenText = 'RESUMEN DE JACKPOT\n' + '='.repeat(50) + '\n\n';
        
        inputs.forEach(input => {
            if (input.value) {
                const label = document.querySelector(`label[for="${input.id}"]`)?.textContent || input.name;
                resumenText += `${label.replace(/\s*\*\s*$/, '')}: ${input.value}\n`;
            }
        });

        resumenText += '\n' + '='.repeat(50) + '\n';
        resumenText += `DURACION TOTAL: ${document.getElementById('duracion3').textContent}`;

        const resumenDiv = document.getElementById('resumen');
        resumenDiv.textContent = resumenText;
        resumenDiv.classList.remove('hidden');
        showNotification('Resumen generado');
    });

    // ===== BORRAR REGISTROS =====
    document.getElementById('btnBorrarRegistros').addEventListener('click', () => {
        if (confirm('Borrar TODOS los registros? Esta accion no se puede deshacer.')) {
            localStorage.removeItem('jackpotRegistros');
            localStorage.removeItem('jackpotLastRecord');
            actualizarTabla();
            showNotification('Todos los registros han sido borrados', 'error');
        }
    });

    // ===== LIMPIAR FORMULARIO =====
    document.getElementById('btnLimpiarTodo').addEventListener('click', () => {
        form.reset();
        document.getElementById('resumen').classList.add('hidden');
        document.getElementById('charCount').textContent = '0';
        ['duracion1', 'duracion2', 'duracion3'].forEach(id => {
            document.getElementById(id).textContent = '-- min';
        });
        showNotification('Formulario limpiado');
    });

    // ===== IR A JACKPOT 2 =====
    document.getElementById('btnJackpot2Header').addEventListener('click', () => {
        window.location.href = 'Jackpot2.html';
    });

    // ===== VOLVER =====
    document.getElementById('btnInicio').addEventListener('click', () => {
        window.location.href = 'index.html';
    });

    // ===== FUNCIONES AUXILIARES DE TABLA =====
    function verDetalle(idx) {
        const registros = JSON.parse(localStorage.getItem('jackpotRegistros') || '[]');
        const reg = registros[idx];
        alert(JSON.stringify(reg.data, null, 2));
    }

    function eliminarRegistro(idx) {
        if (confirm('Eliminar este registro?')) {
            const registros = JSON.parse(localStorage.getItem('jackpotRegistros') || '[]');
            registros.splice(idx, 1);
            localStorage.setItem('jackpotRegistros', JSON.stringify(registros));
            actualizarTabla();
            showNotification('Registro eliminado');
        }
    }

    // ===== INICIALIZACION =====
    window.addEventListener('load', () => {
        actualizarFecha();
        actualizarTabla();
    });
</script>

</html>



