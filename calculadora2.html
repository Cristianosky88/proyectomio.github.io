<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de N√∫meros Mejorada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #f8fafc; font-family: sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .modal.hidden { display: none; }
        .number-tag { cursor: pointer; transition: all 0.2s; }
        .number-tag:hover { transform: scale(1.05); }
        .copy-btn { animation: copyPulse 0.6s ease-out; }
        @keyframes copyPulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">

    <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden border border-slate-200">
        
        <!-- Header -->
        <div class="bg-slate-900 p-5 text-white flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-lg">
                    <i data-lucide="calculator" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Calculadora de N√∫meros</h1>
                    <p class="text-slate-400 text-xs uppercase tracking-wider">Casino Slots - C√°lculos R√°pidos</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-xs text-slate-400">Versi√≥n</div>
                <div class="font-mono font-bold text-lg">3.0</div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12">
            
            <!-- COLUMNA IZQUIERDA: INPUTS -->
            <div class="lg:col-span-7 p-6 space-y-6 bg-slate-50">
                
                <!-- 1. ENTRADA DE N√öMEROS -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 text-sm flex items-center gap-2 mb-4">
                        <span class="bg-slate-200 text-slate-600 w-6 h-6 rounded-full flex items-center justify-center text-xs">1</span>
                        Ingresa tus N√∫meros
                    </h3>

                    <label class="block text-xs font-semibold text-slate-500 mb-2">Pega n√∫meros o expresiones (presiona Enter para calcular):</label>
                    <textarea 
                        id="numbers" 
                        placeholder="Ejemplos:
‚Ä¢ 1.000 2.500,50 3.000
‚Ä¢ 20*20.000,75
‚Ä¢ 100.000+50.000,25
‚Ä¢ (1.500,50+500)*3

Usa punto (.) para miles y coma (,) para decimales"
                        class="w-full h-32 p-3 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 outline-none resize-none bg-slate-50"
                    ></textarea>
                    <div class="text-xs text-slate-500 mt-2">
                        <strong>Formato argentino:</strong> Punto para miles, coma para decimales. Ejemplo: 1.234.567,89
                    </div>
                </div>

                <!-- 2. OPERACIONES B√ÅSICAS -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 text-sm flex items-center gap-2 mb-4">
                        <span class="bg-slate-200 text-slate-600 w-6 h-6 rounded-full flex items-center justify-center text-xs">2</span>
                        Operaciones B√°sicas
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="calculate('sum')" class="px-3 py-2 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 rounded text-xs font-semibold transition">‚ûï Sumar</button>
                        <button onclick="calculate('multiply')" class="px-3 py-2 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 rounded text-xs font-semibold transition">‚úñÔ∏è Multiplicar</button>
                        <button onclick="calculate('subtract')" class="px-3 py-2 bg-slate-100 text-slate-700 hover:bg-slate-200 rounded text-xs font-semibold transition">‚ûñ Restar</button>
                        <button onclick="calculate('divide')" class="px-3 py-2 bg-slate-100 text-slate-700 hover:bg-slate-200 rounded text-xs font-semibold transition">‚ûó Dividir</button>
                        <button onclick="calculate('average')" class="px-3 py-2 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 rounded text-xs font-semibold transition">üìä Promedio</button>
                        <button onclick="calculate('stats')" class="px-3 py-2 bg-indigo-50 text-indigo-700 hover:bg-indigo-100 rounded text-xs font-semibold transition">üìà Estad√≠sticas</button>
                    </div>
                </div>

                <!-- 3. HERRAMIENTAS SLOTS -->
                <div class="bg-gradient-to-r from-indigo-600 to-slate-900 p-4 rounded-lg text-white">
                    <h3 class="font-bold text-sm flex items-center gap-2 mb-4">
                        <i data-lucide="zap" class="w-5 h-5"></i>
                        Herramientas Caja Slots
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="showBillCounter()" class="px-3 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded text-xs font-semibold transition">üí∞ Contador Billetes</button>
                        <button onclick="showPaymentCalc()" class="px-3 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded text-xs font-semibold transition">üí∏ C√°lculo Entrega</button>
                        <button onclick="showCreditConverter()" class="px-3 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded text-xs font-semibold transition">üé´ Cr√©ditos ‚Üî Pesos</button>
                        <button onclick="showShiftBalance()" class="px-3 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded text-xs font-semibold transition">üìã Cuadre Turno</button>
                    </div>
                </div>

                <div class="flex gap-3 pt-2">
                    <button onclick="clearAll()" class="px-4 py-2 text-sm bg-slate-700 hover:bg-slate-800 text-white font-semibold rounded transition flex items-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i> Reset
                    </button>
                    <button onclick="window.location.href='index.html'" class="px-4 py-2 text-sm bg-slate-800 hover:bg-slate-900 text-white font-semibold rounded transition flex items-center gap-2">
                        <i data-lucide="home" class="w-4 h-4"></i> Inicio
                    </button>
                </div>
            </div>

            <!-- COLUMNA DERECHA: RESULTADO -->
            <div class="lg:col-span-5 bg-slate-100 border-l border-slate-200 flex flex-col">
                <div class="p-6 sticky top-0 max-h-screen overflow-y-auto">
                    <!-- N√öMEROS DETECTADOS -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="font-bold text-slate-800">N√∫meros Detectados</h2>
                            <span id="numberCountBadge" class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full font-medium">0</span>
                        </div>
                        
                        <div id="numbersDisplay" class="bg-white rounded-lg shadow-sm border border-slate-300 p-4 min-h-24 hidden">
                            <div id="numberTags" class="flex flex-wrap gap-2 mb-2"></div>
                            <div class="text-xs text-slate-500 italic">Haz clic en un n√∫mero para eliminarlo</div>
                        </div>

                        <div id="noNumbers" class="bg-slate-200 rounded-lg p-4 text-center text-slate-600 text-sm">
                            Los n√∫meros detectados aparecer√°n aqu√≠
                        </div>
                    </div>

                    <!-- RESULTADOS -->
                    <div id="results" class="hidden">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold text-slate-800">üìã Resultados</h3>
                            <button onclick="copyAllResults()" class="text-xs bg-indigo-600 text-white hover:bg-indigo-700 px-2 py-1 rounded transition flex items-center gap-1">
                                <i data-lucide="copy" class="w-3 h-3"></i> Copiar
                            </button>
                        </div>
                        <div id="resultsList" class="bg-white rounded-lg shadow-sm border border-slate-200 p-4 space-y-2"></div>
                    </div>

                    <!-- HISTORIAL -->
                    <div id="historySection" class="hidden mt-6 pt-6 border-t border-slate-300">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-slate-800 flex items-center gap-2">
                                <i data-lucide="history" class="w-4 h-4"></i>
                                Historial
                            </h3>
                            <button onclick="clearHistory()" class="text-xs text-slate-500 hover:text-red-600 transition">Limpiar</button>
                        </div>
                        <div id="historyList" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICACIONES -->
    <div id="toast" class="hidden fixed bottom-4 right-4 bg-green-100 text-green-800 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 fade-in z-40">
        <i data-lucide="check-circle" class="w-4 h-4"></i>
        <span id="toastMessage">Copiado al portapapeles</span>
    </div>

    <!-- MODAL CONTADOR BILLETES -->
    <div id="billCounterModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md max-h-96 overflow-y-auto">
            <div class="sticky top-0 bg-slate-900 text-white p-4 flex items-center gap-2">
                <i data-lucide="banknote" class="w-5 h-5"></i>
                <h3 class="font-bold">Contador de Billetes</h3>
            </div>
            <div class="p-6 space-y-3">
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $20.000:</label>
                    <input type="number" id="bill20000" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total20000">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $10.000:</label>
                    <input type="number" id="bill10000" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total10000">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $2.000:</label>
                    <input type="number" id="bill2000" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total2000">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $1.000:</label>
                    <input type="number" id="bill1000" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total1000">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $500:</label>
                    <input type="number" id="bill500" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total500">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $200:</label>
                    <input type="number" id="bill200" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total200">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $100:</label>
                    <input type="number" id="bill100" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total100">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $50:</label>
                    <input type="number" id="bill50" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total50">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $20:</label>
                    <input type="number" id="bill20" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total20">0</span></span>
                </div>
                <div class="flex justify-between items-center">
                    <label class="text-sm font-semibold text-slate-700">Billetes de $10:</label>
                    <input type="number" id="bill10" value="0" onchange="calculateBillTotal()" oninput="calculateBillTotal()" class="w-16 px-2 py-1 border border-slate-300 rounded text-center">
                    <span class="text-sm font-semibold text-indigo-600">= $<span id="total10">0</span></span>
                </div>
            </div>
            <div class="bg-gradient-to-r from-indigo-700 to-slate-900 text-white p-4">
                <div class="text-center">
                    <div class="text-xs opacity-80 mb-1">TOTAL ARQUEO</div>
                    <div class="text-2xl font-bold">$<span id="arqueoTotal">0</span></div>
                </div>
                <input type="text" id="shouldHave" placeholder="Deber√≠a tener: $" oninput="formatArgentineInput(this); checkDifference()" class="w-full mt-3 px-3 py-2 rounded bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-70 text-center">
                <div id="differenceResult" class="mt-2"></div>
            </div>
            <div class="p-4 border-t border-slate-200">
                <button onclick="closeBillModal()" class="w-full px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded font-semibold text-slate-800 transition">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL PAGO -->
    <div id="paymentModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="sticky top-0 bg-slate-900 text-white p-4 flex items-center gap-2">
                <i data-lucide="credit-card" class="w-5 h-5"></i>
                <h3 class="font-bold">C√°lculo de Entrega</h3>
            </div>
            <div class="p-6">
                <label class="block text-sm font-semibold text-slate-700 mb-2">Monto a entregar:</label>
                <input type="text" id="paymentAmount" placeholder="Ej: 15.750,50" oninput="formatArgentineInput(this); calculateBestPayment()" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-center font-semibold mb-3">
                <div id="paymentBreakdown"></div>
            </div>
            <div class="p-4 border-t border-slate-200">
                <button onclick="closePaymentModal()" class="w-full px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded font-semibold text-slate-800 transition">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL CR√âDITOS -->
    <div id="creditModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="sticky top-0 bg-slate-900 text-white p-4 flex items-center gap-2">
                <i data-lucide="ticket" class="w-5 h-5"></i>
                <h3 class="font-bold">Conversi√≥n Cr√©ditos ‚Üî Pesos</h3>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Valor del cr√©dito: $</label>
                    <input type="number" id="creditValue" value="0.25" step="0.01" oninput="convertCredits()" class="w-full px-3 py-2 border border-slate-300 rounded text-center">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Cr√©ditos:</label>
                    <input type="number" id="credits" placeholder="0" oninput="convertCredits()" class="w-full px-3 py-2 border border-slate-300 rounded text-center">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Pesos: $</label>
                    <input type="number" id="pesos" placeholder="0" oninput="convertPesos()" class="w-full px-3 py-2 border border-slate-300 rounded text-center">
                </div>
                <div id="conversionResult"></div>
            </div>
            <div class="p-4 border-t border-slate-200">
                <button onclick="closeCreditModal()" class="w-full px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded font-semibold text-slate-800 transition">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- MODAL CUADRE -->
    <div id="shiftModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="sticky top-0 bg-slate-900 text-white p-4 flex items-center gap-2">
                <i data-lucide="clipboard-list" class="w-5 h-5"></i>
                <h3 class="font-bold">Cuadre de Turno</h3>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Caja inicial: $</label>
                    <input type="text" id="initialCash" placeholder="0" oninput="formatArgentineInput(this)" class="w-full px-3 py-2 border border-slate-300 rounded text-center">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Ventas del turno: $</label>
                    <input type="text" id="salesAmount" placeholder="0" oninput="formatArgentineInput(this)" class="w-full px-3 py-2 border border-slate-300 rounded text-center">
                </div>
                <div>
                    <label class="block text-xs font-semibold text-slate-500 mb-1">Dinero en caja: $</label>
                    <input type="text" id="cashInBox" placeholder="0" oninput="formatArgentineInput(this)" class="w-full px-3 py-2 border border-slate-300 rounded text-center">
                </div>
                <button onclick="calculateShiftBalance()" class="w-full px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded font-semibold transition">Calcular Cuadre</button>
                <div id="shiftResult"></div>
            </div>
            <div class="p-4 border-t border-slate-200">
                <button onclick="closeShiftModal()" class="w-full px-4 py-2 bg-slate-200 hover:bg-slate-300 rounded font-semibold text-slate-800 transition">Cerrar</button>
            </div>
        </div>
    </div>

</body>

<script>
    lucide.createIcons();
    let numbers = [];
    let history = JSON.parse(localStorage.getItem('calcHistory')) || [];
    
    // Actualizar n√∫meros cuando cambie el textarea
    document.getElementById('numbers').addEventListener('input', function() {
        const text = this.value.trim();
        if (text) {
            numbers = parseInput(text);
            displayNumbers();
        } else {
            numbers = [];
            document.getElementById('numbersDisplay').classList.add('hidden');
            document.getElementById('noNumbers').classList.remove('hidden');
            document.getElementById('results').classList.add('hidden');
            document.getElementById('numberCountBadge').textContent = '0';
        }
    });

    // Tecla Enter para calcular sumatoria
    document.getElementById('numbers').addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && e.ctrlKey) {
            e.preventDefault();
            calculate('sum');
        }
    });
    
    function parseInput(text) {
        const results = [];
        const lines = text.split(/[\n\r]+/);
        
        for (let line of lines) {
            line = line.trim();
            if (!line) continue;
            
            const parts = line.split(/[;]\s*|\s{2,}/);
            
            for (let part of parts) {
                part = part.trim();
                if (!part) continue;
                
                try {
                    if (/[+\-*/()]/.test(part)) {
                        let expression = convertArgentineToJS(part);
                        const result = evaluateExpression(expression);
                        if (!isNaN(result) && isFinite(result)) {
                            results.push(result);
                        }
                    } else {
                        const num = parseArgentineNumber(part);
                        if (!isNaN(num) && isFinite(num)) {
                            results.push(num);
                        }
                    }
                } catch (e) {
                    const argNumbers = extractArgentineNumbers(part);
                    results.push(...argNumbers);
                }
            }
        }
        
        return results;
    }
    
    function parseArgentineNumber(str) {
        if (!str) return NaN;
        
        str = str.replace(/\s/g, '');
        
        if (!str.includes(',')) {
            if (/^\d{1,3}(\.\d{3})*$/.test(str)) {
                return parseFloat(str.replace(/\./g, ''));
            }
            if (/^\d+$/.test(str)) {
                return parseFloat(str);
            }
            return NaN;
        }
        
        const parts = str.split(',');
        if (parts.length !== 2) return NaN;
        
        const integerPart = parts[0];
        const decimalPart = parts[1];
        
        if (!/^\d{1,2}$/.test(decimalPart)) return NaN;
        
        let cleanInteger;
        if (/^\d{1,3}(\.\d{3})*$/.test(integerPart)) {
            cleanInteger = integerPart.replace(/\./g, '');
        } else if (/^\d+$/.test(integerPart)) {
            cleanInteger = integerPart;
        } else {
            return NaN;
        }
        
        const result = parseFloat(cleanInteger + '.' + decimalPart);
        return isNaN(result) ? NaN : result;
    }
    
    function convertArgentineToJS(expr) {
        return expr.replace(/\d{1,3}(?:\.\d{3})*(?:,\d+)?/g, function(match) {
            return parseArgentineNumber(match).toString();
        });
    }
    
    function extractArgentineNumbers(text) {
        const numbers = [];
        const regex = /\d{1,3}(?:\.\d{3})*(?:,\d+)?|\d+,\d+|\d+/g;
        const matches = text.match(regex);
        
        if (matches) {
            matches.forEach(match => {
                const num = parseArgentineNumber(match);
                if (!isNaN(num) && isFinite(num)) {
                    numbers.push(num);
                }
            });
        }
        
        return numbers;
    }
    
    function formatArgentineNumber(num) {
        return num.toLocaleString('es-AR', { 
            minimumFractionDigits: 0, 
            maximumFractionDigits: 2 
        });
    }
    
    function formatArgentineInput(input) {
        const value = input.value.replace(/[^\d,]/g, '');
        const parts = value.split(',');
        
        if (parts[0]) {
            const intPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            input.value = parts[1] !== undefined ? intPart + ',' + parts[1].substring(0, 2) : intPart;
        }
    }
    
    function evaluateExpression(expr) {
        expr = expr.replace(/\s/g, '');
        
        if (!/^[0-9+\-*/.() ]+$/.test(expr)) {
            throw new Error('Expresi√≥n no v√°lida');
        }
        
        return Function('"use strict"; return (' + expr + ')')();
    }
    
    function displayNumbers() {
        const display = document.getElementById('numbersDisplay');
        const tagsContainer = document.getElementById('numberTags');
        const noNumbers = document.getElementById('noNumbers');
        
        if (numbers.length > 0) {
            display.classList.remove('hidden');
            noNumbers.classList.add('hidden');
            tagsContainer.innerHTML = numbers.map((num, index) => 
                `<span class="number-tag inline-block bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-xs font-semibold cursor-pointer hover:bg-indigo-200" onclick="deleteNumber(${index})" title="Haz clic para eliminar">${formatArgentineNumber(num)}</span>`
            ).join('');
            document.getElementById('numberCountBadge').textContent = numbers.length;
        } else {
            display.classList.add('hidden');
            noNumbers.classList.remove('hidden');
            document.getElementById('numberCountBadge').textContent = '0';
        }
    }

    function deleteNumber(index) {
        numbers.splice(index, 1);
        displayNumbers();
        if (numbers.length === 0) {
            document.getElementById('results').classList.add('hidden');
        }
    }
    
    function calculate(operation) {
        if (numbers.length === 0) {
            alert('Por favor, ingresa algunos n√∫meros primero.');
            return;
        }
        
        const results = document.getElementById('results');
        const resultsList = document.getElementById('resultsList');
        let result = '';
        let resultValue = null;
        
        switch(operation) {
            case 'sum':
                resultValue = numbers.reduce((a, b) => a + b, 0);
                result = `
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Suma total:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${formatArgentineNumber(resultValue)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(resultValue)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
                break;
                
            case 'multiply':
                resultValue = numbers.reduce((a, b) => a * b, 1);
                result = `
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Producto total:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${formatArgentineNumber(resultValue)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(resultValue)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
                break;
                
            case 'subtract':
                resultValue = numbers.reduce((a, b) => a - b);
                result = `
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Resta secuencial:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${formatArgentineNumber(resultValue)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(resultValue)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
                break;
                
            case 'divide':
                resultValue = numbers.reduce((a, b) => a / b);
                result = `
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Divisi√≥n secuencial:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${formatArgentineNumber(resultValue)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(resultValue)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
                break;
                
            case 'average':
                resultValue = numbers.reduce((a, b) => a + b, 0) / numbers.length;
                result = `
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Promedio:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${formatArgentineNumber(resultValue)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(resultValue)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
                break;
                
            case 'stats':
                const sum_stats = numbers.reduce((a, b) => a + b, 0);
                const avg_stats = sum_stats / numbers.length;
                const min = Math.min(...numbers);
                const max = Math.max(...numbers);
                const count = numbers.length;
                
                result = `
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Cantidad:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${count}</span>
                            <button onclick="copySingleResult('${count}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Suma:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${formatArgentineNumber(sum_stats)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(sum_stats)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">Promedio:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-indigo-600">${formatArgentineNumber(avg_stats)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(avg_stats)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between py-2 border-b border-slate-200 items-center group">
                        <span class="font-semibold text-slate-700">M√≠nimo:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-green-600">${formatArgentineNumber(min)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(min)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex justify-between py-2 items-center group">
                        <span class="font-semibold text-slate-700">M√°ximo:</span>
                        <div class="flex items-center gap-2">
                            <span class="font-mono font-bold text-red-600">${formatArgentineNumber(max)}</span>
                            <button onclick="copySingleResult('${formatArgentineNumber(max)}')" class="opacity-0 group-hover:opacity-100 transition text-xs p-1 hover:bg-slate-200 rounded">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                            </button>
                        </div>
                    </div>
                `;
                break;
        }
        
        resultsList.innerHTML = result;
        results.classList.remove('hidden');
        
        // Agregar al historial
        if (resultValue !== null) {
            addToHistory(operation, resultValue);
        }
        
        results.scrollIntoView({ behavior: 'smooth' });
        lucide.createIcons();
    }

    function addToHistory(operation, value) {
        const operationNames = {
            'sum': 'Suma', 'multiply': 'Multiplicaci√≥n', 'subtract': 'Resta',
            'divide': 'Divisi√≥n', 'average': 'Promedio', 'stats': 'Estad√≠sticas'
        };

        const entry = {
            operation: operationNames[operation],
            value: formatArgentineNumber(value),
            time: new Date().toLocaleTimeString('es-AR', { hour: '2-digit', minute: '2-digit' })
        };

        history.unshift(entry);
        if (history.length > 10) history.pop();
        localStorage.setItem('calcHistory', JSON.stringify(history));
        displayHistory();
    }

    function displayHistory() {
        if (history.length === 0) {
            document.getElementById('historySection').classList.add('hidden');
            return;
        }

        document.getElementById('historySection').classList.remove('hidden');
        const historyList = document.getElementById('historyList');
        historyList.innerHTML = history.map((entry, idx) => `
            <div class="bg-slate-100 p-2 rounded border border-slate-200 flex justify-between items-center text-xs hover:bg-slate-200 transition">
                <div>
                    <span class="font-semibold text-slate-700">${entry.operation}</span>
                    <span class="text-slate-500 ml-2">${entry.time}</span>
                </div>
                <div class="flex items-center gap-1">
                    <span class="font-mono font-bold text-indigo-600">${entry.value}</span>
                    <button onclick="copySingleResult('${entry.value}')" class="p-1 hover:bg-slate-300 rounded text-xs">
                        <i data-lucide="copy" class="w-3 h-3"></i>
                    </button>
                </div>
            </div>
        `).join('');
        lucide.createIcons();
    }

    function clearHistory() {
        if (confirm('¬øLimpiar historial?')) {
            history = [];
            localStorage.removeItem('calcHistory');
            displayHistory();
        }
    }

    function copySingleResult(text) {
        navigator.clipboard.writeText(text.replace(/\./g, '').replace(',', '.')).then(() => {
            showToast('Copiado al portapapeles');
        });
    }

    function copyAllResults() {
        const resultsText = document.getElementById('resultsList').innerText;
        navigator.clipboard.writeText(resultsText).then(() => {
            showToast('Resultados copiados');
        });
    }

    function showToast(message) {
        const toast = document.getElementById('toast');
        document.getElementById('toastMessage').textContent = message;
        toast.classList.remove('hidden');
        setTimeout(() => toast.classList.add('hidden'), 3000);
    }
    
    function clearAll() {
        document.getElementById('numbers').value = '';
        document.getElementById('numbersDisplay').classList.add('hidden');
        document.getElementById('noNumbers').classList.remove('hidden');
        document.getElementById('results').classList.add('hidden');
        numbers = [];
        document.getElementById('numberCountBadge').textContent = '0';
    }
    
    // MODALES
    function showBillCounter() {
        document.getElementById('billCounterModal').classList.remove('hidden');
        calculateBillTotal();
    }
    
    function closeBillModal() {
        document.getElementById('billCounterModal').classList.add('hidden');
    }
    
    function showPaymentCalc() {
        document.getElementById('paymentModal').classList.remove('hidden');
    }
    
    function closePaymentModal() {
        document.getElementById('paymentModal').classList.add('hidden');
    }
    
    function showCreditConverter() {
        document.getElementById('creditModal').classList.remove('hidden');
    }
    
    function closeCreditModal() {
        document.getElementById('creditModal').classList.add('hidden');
    }
    
    function showShiftBalance() {
        document.getElementById('shiftModal').classList.remove('hidden');
    }
    
    function closeShiftModal() {
        document.getElementById('shiftModal').classList.add('hidden');
    }
    
    function calculateBillTotal() {
        const bills = {
            20000: parseInt(document.getElementById('bill20000').value) || 0,
            10000: parseInt(document.getElementById('bill10000').value) || 0,
            2000: parseInt(document.getElementById('bill2000').value) || 0,
            1000: parseInt(document.getElementById('bill1000').value) || 0,
            500: parseInt(document.getElementById('bill500').value) || 0,
            200: parseInt(document.getElementById('bill200').value) || 0,
            100: parseInt(document.getElementById('bill100').value) || 0,
            50: parseInt(document.getElementById('bill50').value) || 0,
            20: parseInt(document.getElementById('bill20').value) || 0,
            10: parseInt(document.getElementById('bill10').value) || 0
        };
        
        Object.keys(bills).forEach(denomination => {
            const total = bills[denomination] * parseInt(denomination);
            document.getElementById(`total${denomination}`).textContent = formatArgentineNumber(total);
        });
        
        const grandTotal = Object.keys(bills).reduce((sum, denom) => {
            return sum + (bills[denom] * parseInt(denom));
        }, 0);
        
        document.getElementById('arqueoTotal').textContent = formatArgentineNumber(grandTotal);
        checkDifference();
    }
    
    function checkDifference() {
        const actualText = document.getElementById('arqueoTotal').textContent;
        const actual = parseArgentineNumber(actualText) || 0;
        const shouldHaveText = document.getElementById('shouldHave').value;
        const shouldHave = parseArgentineNumber(shouldHaveText) || 0;
        const difference = actual - shouldHave;
        
        const resultDiv = document.getElementById('differenceResult');
        
        if (shouldHave === 0) {
            resultDiv.innerHTML = '';
            return;
        }
        
        if (difference === 0) {
            resultDiv.innerHTML = '<div class="mt-2 p-2 bg-green-100 text-green-700 rounded text-xs font-semibold text-center">‚úÖ PERFECTO - SIN DIFERENCIAS</div>';
        } else if (difference > 0) {
            resultDiv.innerHTML = `<div class="mt-2 p-2 bg-yellow-100 text-yellow-700 rounded text-xs font-semibold text-center">üìà SOBRANTE: ${formatArgentineNumber(Math.abs(difference))}</div>`;
        } else {
            resultDiv.innerHTML = `<div class="mt-2 p-2 bg-red-100 text-red-700 rounded text-xs font-semibold text-center">üìâ FALTANTE: ${formatArgentineNumber(Math.abs(difference))}</div>`;
        }
    }
    
    function calculateBestPayment() {
        const amountText = document.getElementById('paymentAmount').value;
        const amount = parseArgentineNumber(amountText) || 0;
        if (amount === 0) return;
        
        const bills = [20000, 10000, 2000, 1000, 500, 200, 100, 50, 20, 10];
        let remaining = Math.floor(amount);
        const breakdown = {};
        
        bills.forEach(bill => {
            if (remaining >= bill) {
                breakdown[bill] = Math.floor(remaining / bill);
                remaining = remaining % bill;
            }
        });
        
        let html = '<div class="bg-slate-50 p-3 rounded border border-slate-200"><h4 class="text-sm font-semibold text-slate-700 mb-2">üí∏ Mejor forma de entregar:</h4>';
        Object.keys(breakdown).forEach(bill => {
            if (breakdown[bill] > 0) {
                html += `<div class="flex justify-between text-sm py-1">
                    <span class="text-slate-600">${breakdown[bill]}x $${formatArgentineNumber(parseInt(bill))}:</span>
                    <span class="font-semibold text-indigo-600">${formatArgentineNumber(breakdown[bill] * parseInt(bill))}</span>
                </div>`;
            }
        });
        
        const totalEntregado = Object.keys(breakdown).reduce((sum, bill) => sum + (breakdown[bill] * parseInt(bill)), 0);
        const diferencia = amount - totalEntregado;
        
        html += `<div class="border-t border-slate-300 mt-2 pt-2 flex justify-between font-semibold text-sm">
            <span class="text-slate-700">Total:</span>
            <span class="text-indigo-600">${formatArgentineNumber(totalEntregado)}</span>
        </div>`;
        
        if (diferencia > 0) {
            html += `<div class="mt-2 p-2 bg-yellow-100 text-yellow-700 rounded text-xs text-center font-semibold">Falta (en monedas): ${formatArgentineNumber(diferencia)}</div>`;
        }
        
        html += '</div>';
        document.getElementById('paymentBreakdown').innerHTML = html;
    }
    
    function convertCredits() {
        const creditValue = parseFloat(document.getElementById('creditValue').value) || 0;
        const credits = parseFloat(document.getElementById('credits').value) || 0;
        
        if (creditValue > 0 && credits > 0) {
            const pesos = credits * creditValue;
            document.getElementById('pesos').value = pesos.toFixed(2);
            updateConversionResult(credits, pesos, creditValue);
        }
    }
    
    function convertPesos() {
        const creditValue = parseFloat(document.getElementById('creditValue').value) || 0;
        const pesos = parseFloat(document.getElementById('pesos').value) || 0;
        
        if (creditValue > 0 && pesos > 0) {
            const credits = pesos / creditValue;
            document.getElementById('credits').value = credits.toFixed(2);
            updateConversionResult(credits, pesos, creditValue);
        }
    }
    
    function updateConversionResult(credits, pesos, creditValue) {
        const resultDiv = document.getElementById('conversionResult');
        resultDiv.innerHTML = `
            <div class="bg-slate-50 p-3 rounded border border-slate-200">
                <h4 class="text-sm font-semibold text-slate-700 mb-2">üé´ Conversi√≥n:</h4>
                <div class="flex justify-between text-sm py-1">
                    <span class="text-slate-600">Cr√©ditos:</span>
                    <span class="font-semibold text-indigo-600">${formatArgentineNumber(credits)}</span>
                </div>
                <div class="flex justify-between text-sm py-1">
                    <span class="text-slate-600">Valor por cr√©dito:</span>
                    <span class="font-semibold text-indigo-600">$${creditValue.toFixed(2)}</span>
                </div>
                <div class="flex justify-between text-sm py-1 border-t border-slate-300 pt-2 mt-2 font-semibold">
                    <span class="text-slate-700">Total en pesos:</span>
                    <span class="text-green-600">$${formatArgentineNumber(pesos)}</span>
                </div>
            </div>
        `;
    }
    
    function calculateShiftBalance() {
        const initial = parseArgentineNumber(document.getElementById('initialCash').value) || 0;
        const sales = parseArgentineNumber(document.getElementById('salesAmount').value) || 0;
        const cashInBox = parseArgentineNumber(document.getElementById('cashInBox').value) || 0;
        
        const expectedTotal = initial + sales;
        const difference = cashInBox - expectedTotal;
        
        let resultHTML = `
            <div class="bg-slate-50 p-3 rounded border border-slate-200 mt-4">
                <h4 class="text-sm font-semibold text-slate-700 mb-2">üìä Resultado del Cuadre:</h4>
                <div class="flex justify-between text-sm py-1">
                    <span class="text-slate-600">Caja inicial:</span>
                    <span class="font-semibold text-indigo-600">$${formatArgentineNumber(initial)}</span>
                </div>
                <div class="flex justify-between text-sm py-1">
                    <span class="text-slate-600">Ventas:</span>
                    <span class="font-semibold text-indigo-600">$${formatArgentineNumber(sales)}</span>
                </div>
                <div class="flex justify-between text-sm py-1 border-t border-slate-300 pt-2 mt-1 font-semibold">
                    <span class="text-slate-700">Deber√≠a tener:</span>
                    <span class="text-indigo-600">$${formatArgentineNumber(expectedTotal)}</span>
                </div>
                <div class="flex justify-between text-sm py-1">
                    <span class="text-slate-600">Dinero real:</span>
                    <span class="font-semibold text-indigo-600">$${formatArgentineNumber(cashInBox)}</span>
                </div>
                <div class="flex justify-between text-sm py-1 border-t border-slate-300 pt-2 mt-1">
                    <span class="text-slate-700 font-semibold">Diferencia:</span>
                    <span class="font-mono font-bold" style="color: ${difference === 0 ? '#059669' : '#dc2626'}">$${formatArgentineNumber(difference)}</span>
                </div>
        `;
        
        if (difference === 0) {
            resultHTML += '<div class="mt-2 p-2 bg-green-100 text-green-700 rounded text-xs text-center font-semibold">‚úÖ CUADRE PERFECTO</div>';
        } else if (difference > 0) {
            resultHTML += '<div class="mt-2 p-2 bg-yellow-100 text-yellow-700 rounded text-xs text-center font-semibold">üìà SOBRANTE</div>';
        } else {
            resultHTML += '<div class="mt-2 p-2 bg-red-100 text-red-700 rounded text-xs text-center font-semibold">üìâ FALTANTE</div>';
        }
        
        resultHTML += '</div>';
        document.getElementById('shiftResult').innerHTML = resultHTML;
    }
    
    // Cerrar modales al hacer click fuera
    window.onclick = function(event) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (event.target === modal) {
                modal.classList.add('hidden');
            }
        });
    }

    // Cargar historial al iniciar
    displayHistory();
</script>

</html>



