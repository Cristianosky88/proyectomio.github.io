<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador T√©cnico CCTV - Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { background-color: #f8fafc; font-family: sans-serif; }
        .report-font { 
            font-family: 'Times New Roman', Times, serif; 
            line-height: 1.5;
        }
        textarea { resize: none; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-4 md:p-8 text-slate-800">

    <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden border border-slate-200">
        
        <!-- Header -->
        <div class="bg-slate-900 p-5 text-white flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 p-2 rounded-lg">
                    <i data-lucide="wrench" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold">Gesti√≥n T√©cnica CCTV</h1>
                    <p class="text-slate-400 text-xs uppercase tracking-wider">Sistema de Registro - Monitoreo</p>
                </div>
            </div>
            <div class="flex items-center gap-3 bg-slate-800 px-4 py-2 rounded-lg border border-slate-700">
                <span class="text-xs font-semibold text-blue-400">Hora Llamada:</span>
                <input type="time" id="horaLlamada" oninput="sincronizarTodo()" class="bg-transparent text-white font-mono outline-none">
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12">
            
            <!-- COLUMNA IZQUIERDA: FORMULARIO -->
            <div class="lg:col-span-5 p-6 space-y-4 bg-slate-50">
                <!-- Tarea y T√©cnico -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 text-sm mb-4">üîß Datos del Servicio</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 mb-1">üìã Tipo de Tarea</label>
                            <select id="tipoTarea" onchange="sincronizarTodo()" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="Cerado">Cerado de M√°quina</option>
                                <option value="Mantenimiento Preventivo">Mantenimiento Preventivo</option>
                                <option value="Reparaci√≥n T√©cnica">Reparaci√≥n T√©cnica</option>
                                <option value="Cambio de Monitor">Cambio de Monitor</option>
                                <option value="Revisi√≥n de Conectividad">Revisi√≥n de Conectividad</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 mb-1">üë§ T√©cnico</label>
                            <input type="text" id="tecnico" list="tecnicos-list" placeholder="Ej: Mansilla Nicol√°s" oninput="sincronizarTodo()" class="w-full p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                            <datalist id="tecnicos-list">
                                <option value="Mansilla Nicol√°s">
                                <option value="Perez Juan">
                                <option value="Rodriguez Luis">
                                <option value="Gonzalez Carlos">
                            </datalist>
                        </div>
                    </div>
                </div>

                <!-- Carga Masiva -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                    <h3 class="font-bold text-slate-700 text-sm mb-4 flex items-center gap-2">
                        <i data-lucide="layers" class="w-4 h-4"></i>
                        Carga Masiva (Rango)
                    </h3>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <input type="number" id="rangoInicio" placeholder="Desde ID" class="p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                        <input type="number" id="rangoFin" placeholder="Hasta ID" class="p-2 bg-white border border-slate-300 rounded text-sm focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <button onclick="aplicarRango()" class="w-full bg-blue-600 text-white py-2 rounded font-semibold text-sm hover:bg-blue-700 transition">
                        Generar Bloque
                    </button>
                </div>

                <div class="flex gap-2 pt-4">
                    <button type="button" onclick="limpiarSeccion()" class="flex-1 px-4 py-2 bg-red-600 text-white hover:bg-red-700 rounded font-semibold text-sm transition flex items-center justify-center gap-2">
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                        <span>Limpiar</span>
                    </button>
                    <button type="button" onclick="window.location.href='index.html'" class="px-4 py-2 bg-slate-800 text-white hover:bg-slate-700 rounded font-semibold text-sm transition flex items-center justify-center gap-2">
                        <i data-lucide="home" class="w-4 h-4"></i>
                        <span>Inicio</span>
                    </button>
                </div>
            </div>

            <!-- COLUMNA DERECHA: RESULTADO -->
            <div class="lg:col-span-7 bg-slate-100 border-l border-slate-200 flex flex-col">
                <div class="p-6 flex flex-col" style="height: calc(100vh - 120px);">
                    <!-- Lista de M√°quinas -->
                    <div class="flex-shrink-0 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="font-bold text-slate-800 text-sm">üìã Cronolog√≠a de Trabajo</h2>
                            <button onclick="agregarFila()" class="px-3 py-1.5 bg-blue-600 text-white rounded text-xs font-semibold hover:bg-blue-700 transition flex items-center gap-1">
                                <i data-lucide="plus" class="w-3 h-3"></i>
                                A√±adir M√°quina
                            </button>
                        </div>
                        <div id="contenedorMaquinas" class="space-y-2 h-48 overflow-y-auto bg-white rounded-lg shadow-sm border border-slate-300 p-3">
                            <!-- Las m√°quinas se insertan aqu√≠ -->
                        </div>
                    </div>

                    <!-- Resultado Final -->
                    <div class="flex-1 flex flex-col min-h-0">
                        <div class="flex items-center justify-between mb-3 flex-shrink-0">
                            <h2 class="font-bold text-slate-800 text-sm">üìÑ Texto Generado</h2>
                            <button onclick="copiarTexto()" class="px-3 py-1.5 bg-green-600 text-white hover:bg-green-700 rounded text-xs font-semibold transition flex items-center gap-1">
                                <i data-lucide="copy" class="w-3 h-3"></i>
                                Copiar
                            </button>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-sm border border-slate-300 p-4 flex-1 min-h-0">
                            <textarea id="output" class="report-font w-full h-full p-3 bg-slate-50 border border-slate-200 rounded text-sm outline-none focus:bg-white focus:ring-2 focus:ring-blue-100 transition-all resize-none" spellcheck="false"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICACIONES -->
    <div id="notification" class="hidden fixed bottom-4 right-4 bg-green-100 text-green-800 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 fade-in z-40">
        <i data-lucide="check-circle" class="w-4 h-4"></i>
        <span id="notification-text">Texto copiado al portapapeles</span>
    </div>

</body>

<script>
    lucide.createIcons();
        function getHoraActual(offsetMinutos = 0) {
            const ahora = new Date();
            ahora.setMinutes(ahora.getMinutes() + offsetMinutos);
            return `${String(ahora.getHours()).padStart(2, '0')}:${String(ahora.getMinutes()).padStart(2, '0')}`;
        }

        function ponerHoraActual(id) {
            const el = document.getElementById(id);
            if(el) {
                el.value = getHoraActual();
                sincronizarTodo();
            }
        }

        function ponerHoraEnElemento(btn) {
            const input = btn.previousElementSibling;
            input.value = getHoraActual();
            sincronizarTodo();
        }

        function agregarFila(idMaq = "", hInicio = "", hFin = "", nroInf = "") {
            const contenedor = document.getElementById('contenedorMaquinas');
            const div = document.createElement('div');
            div.className = "p-3 bg-slate-50 rounded border border-slate-200 space-y-2";
            div.innerHTML = `
                <div class="grid grid-cols-12 gap-2 items-end">
                    <div class="col-span-12">
                        <label class="block text-[9px] font-semibold text-slate-500 mb-1">ID M√°quina</label>
                        <input type="text" class="maq-id w-full p-1.5 border border-slate-300 rounded text-xs outline-none focus:ring-1 focus:ring-blue-500" value="${idMaq}" oninput="sincronizarTodo()" placeholder="Ej: 110490-06">
                    </div>
                    
                    <div class="col-span-6">
                        <label class="block text-[9px] font-semibold text-slate-500 mb-1">‚è∞ Inicio</label>
                        <input type="time" class="maq-inicio w-full p-1.5 border border-slate-300 rounded text-xs outline-none focus:ring-1 focus:ring-blue-500" value="${hInicio}" oninput="sincronizarTodo()">
                    </div>
                    
                    <div class="col-span-6">
                        <label class="block text-[9px] font-semibold text-slate-500 mb-1">‚è∞ Fin</label>
                        <input type="time" class="maq-fin w-full p-1.5 border border-slate-300 rounded text-xs outline-none focus:ring-1 focus:ring-blue-500" value="${hFin}" oninput="sincronizarTodo()">
                    </div>
                    
                    <div class="col-span-8">
                        <label class="block text-[9px] font-semibold text-slate-500 mb-1">üìπ Estado C√°mara</label>
                        <select class="maq-estado w-full p-1.5 border border-slate-300 rounded text-xs outline-none focus:ring-1 focus:ring-blue-500" onchange="sincronizarTodo()">
                            <option value="Correcta">Correcta</option>
                            <option value="Intermitente">Intermitente</option>
                            <option value="Sin Se√±al">Sin Se√±al</option>
                            <option value="√Ångulo Obstruido">√Ångulo Obstruido</option>
                        </select>
                    </div>
                    
                    <div class="col-span-4">
                        <label class="block text-[9px] font-semibold text-slate-500 mb-1">üìã Informe N¬∫</label>
                        <input type="text" class="maq-informe w-full p-1.5 border border-slate-300 rounded text-xs outline-none focus:ring-1 focus:ring-blue-500" value="${nroInf}" oninput="sincronizarTodo()" placeholder="12345">
                    </div>
                </div>
                
                <button onclick="this.parentElement.remove(); sincronizarTodo(); lucide.createIcons();" class="w-full px-2 py-1 text-xs text-red-600 hover:bg-red-50 rounded transition flex items-center justify-center gap-1">
                    <i data-lucide="trash-2" class="w-3 h-3"></i>
                    <span>Eliminar</span>
                </button>
            `;
            contenedor.appendChild(div);
            lucide.createIcons();
            sincronizarTodo();
        }

        function aplicarRango() {
            const inicio = parseInt(document.getElementById('rangoInicio').value);
            const fin = parseInt(document.getElementById('rangoFin').value);
            if(!inicio || !fin || fin < inicio) return;
            for(let i = inicio; i <= fin; i++) {
                agregarFila(i.toString());
            }
        }

        function sincronizarTodo() {
            const hLlamada = document.getElementById('horaLlamada').value;
            const tecnico = document.getElementById('tecnico').value || "[Nombre del T√©cnico]";
            const tarea = document.getElementById('tipoTarea').value;
            
            const maqIds = Array.from(document.querySelectorAll('.maq-id')).map(i => i.value);
            const maqInicios = Array.from(document.querySelectorAll('.maq-inicio')).map(i => i.value);
            const maqFines = Array.from(document.querySelectorAll('.maq-fin')).map(i => i.value);
            const maqEstados = Array.from(document.querySelectorAll('.maq-estado')).map(i => i.value);
            const maqInformes = Array.from(document.querySelectorAll('.maq-informe')).map(i => i.value);

            // Cabecera Din√°mica
            const listaMaq = maqIds.filter(id => id).map(id => `M√°q. ${id}`).join(' y ');
            
            // L√≥gica de estado de c√°mara global basado en la primera m√°quina o si hay fallos
            const algunFallo = maqEstados.some(e => e !== 'Correcta');
            const respuestaCamaras = algunFallo ? 
                `CCTV le informa que se observan anomal√≠as en algunas c√°maras durante el procedimiento.-` : 
                `CCTV le responde que las c√°maras y conexi√≥n funcionan correctamente.-`;

            let texto = `A las ${hLlamada} Hs. CCTV recibe llamada de T√©cnico ${tecnico}, solicita confirmaci√≥n de visualizaci√≥n de c√°mara y conexi√≥n online para realizar ${tarea} de ${listaMaq || "[M√°quinas]"}.\n` +
                        `${respuestaCamaras}\n\n`;

            // Detalle por m√°quina
            maqIds.forEach((id, index) => {
                if (id) {
                    const hIni = maqInicios[index];
                    const hFin = maqFines[index];
                    const estado = maqEstados[index];
                    const inf = maqInformes[index];
                    
                    if (hIni) {
                        texto += `A las ${hIni} Hs. T√©cnico ${tecnico}, informa que inicia ${tarea} de M√°quina ${id}.-\n`;
                    }
                    if (hFin) {
                        let textoEstado = estado === 'Correcta' ? '' : ` (Visualizaci√≥n: ${estado})`;
                        texto += `A las ${hFin} Hs. T√©cnico ${tecnico}, informa que finaliz√≥ ${tarea} de M√°quina ${id} con Informe T√©cnico N¬∫ ${inf || "[N¬∫]"}${textoEstado}.-\n\n`;
                    }
                }
            });

            document.getElementById('output').value = texto.trim();
        }

        function limpiarSeccion() {
            document.getElementById('tecnico').value = "";
            document.getElementById('rangoInicio').value = "";
            document.getElementById('rangoFin').value = "";
            document.getElementById('contenedorMaquinas').innerHTML = "";
            sincronizarTodo();
        }

        function volverAlInicio() {
            const now = new Date();
            const horas = String(now.getHours()).padStart(2, '0');
            const minutos = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('horaLlamada').value = `${horas}:${minutos}`;
            document.getElementById('tecnico').value = "";
            document.getElementById('tipoTarea').value = "Cerado";
            
            const contenedor = document.getElementById('contenedorMaquinas');
            contenedor.innerHTML = "";
            sincronizarTodo();
        }

        function copiarTexto() {
            const el = document.getElementById('output');
            const textoParaCopiar = el.value;
            
            navigator.clipboard.writeText(textoParaCopiar).then(() => {
                showNotification('¬°Texto copiado al portapapeles!');
            }).catch(() => {
                el.select();
                document.execCommand('copy');
                showNotification('¬°Texto copiado al portapapeles!');
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            document.getElementById('notification-text').textContent = message;
            notification.classList.remove('hidden', 'bg-red-100', 'text-red-800');
            if (type === 'error') {
                notification.classList.add('bg-red-100', 'text-red-800');
            } else {
                notification.classList.add('bg-green-100', 'text-green-800');
            }
            setTimeout(() => notification.classList.add('hidden'), 3000);
        }

        window.onload = () => volverAlInicio();
    </script>
</body>
</html>